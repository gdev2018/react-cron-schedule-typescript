import e,{useReducer as t,createContext as n,useContext as a,useCallback as l,useEffect as o}from"react";const r={SetRepeat:"SetRepeat",SetFrequency:"SetFrequency",SetMonthOption:"SetMonthOption",SetSelectedWeeks:"SetSelectedWeeks",SetMonthDate:"SetMonthDate",SetMonthDay:"SetMonthDay",SetMonthDayOrder:"SetMonthDayOrder",SetInitialProps:"SetInitialProps",SetEndType:"SetEndType",SetEndDate:"SetEndDate",SetEndCount:"SetEndCount",SetStartDate:"SetStartDate",SetCronExp:"SetCronExp"},d=(e=null)=>{let t=new Date;e&&(t=new Date(e));let n=t.getDate(),a=t.getMonth()+1;return n<10&&(n=`0${n}`),a<10&&(a=`0${a}`),`${t.getFullYear()}-${a}-${n}`},c=e=>"number"==typeof e?d(e):e,s=(e,t)=>{switch(t.type){case r.SetRepeat:return{...e,repeat:t.payload};case r.SetFrequency:return{...e,frequency:Number(t.payload)};case r.SetMonthOption:return{...e,monthOption:t.payload};case r.SetSelectedWeeks:return{...e,selectedWeeks:t.payload||[]};case r.SetMonthDate:return{...e,selectedMonthDate:Number(t.payload)};case r.SetMonthDay:return{...e,selectedMonthDay:t.payload};case r.SetMonthDayOrder:return{...e,selectedMonthDayOrder:t.payload};case r.SetStartDate:return{...e,startDate:t.payload};case r.SetEndType:return{...e,selectedEndType:t.payload};case r.SetEndDate:return{...e,endDate:t.payload};case r.SetEndCount:return{...e,endCount:Number(t.payload)};case r.SetInitialProps:return{...e,repeat:t.payload?.repeat||"weekly",disabled:t.payload?.disabled,showFrequency:t.payload?.showFrequency,frequency:t.payload?.frequency||1,startDate:t.payload?.startDate?c(t.payload?.startDate):d(),endDate:t.payload?.endDate?c(t.payload?.endDate):d(),selectedEndType:t.payload?.selectedEndType||"noend",endCount:t.payload?.endCount||10,selectedWeeks:t.payload?.selectedWeeks||[(new Date).getDay()],monthOption:t.payload?.monthOption||"standard",selectedMonthDate:t.payload?.selectedMonthDate||(new Date).getDate(),selectedMonthDayOrder:t.payload?.selectedMonthDayOrder||"First",selectedMonthDay:t.payload?.selectedMonthDay||"Day"};case r.SetCronExp:return{...e,cronExpression:t.payload};default:return e}},i=n({}),u={repeat:"weekly",frequency:1,selectedWeeks:[(new Date).getDay()],monthOption:"standard",selectedMonthDate:(new Date).getDate(),selectedMonthDayOrder:"First",selectedMonthDay:"Day",selectedEndType:"noend",startDate:d(),endDate:d(),endCount:10,disabled:!1,showFrequency:!0,cronExpression:""};var m=n=>{const[a,l]=t(s,u);return e.createElement(i.Provider,{value:{recurrenceData:a,dispatch:l}},n.children)};const y=[{name:"Sunday",value:0},{name:"Monday",value:1},{name:"Tuesday",value:2},{name:"Wednesday",value:3},{name:"Thursday",value:4},{name:"Friday",value:5},{name:"Saturday",value:6}],p=["January","February","March","April","May","June","July","August","September","October","November","December"],_=e=>e&&e.length>0?7===e.length?"0 0 ? * ?":(e.sort(),`0 0 ? * ${e.join(",")}`):"",h=e=>e&&e>=1&&e<=31?`0 0 ${e} * ?`:"",D=e=>{const t=y.find((t=>t.name===e))?.value;return t>=0&&t<=6?`0 0 ? * ${t}L`:""},S=(e,t)=>{const n=y.find((e=>e.name===t))?.value;return e>=1&&e<=4&&n>=0&&n<=6?`0 0 ? * ${n}#${e}`:""},b=e=>"First"===e?1:"Second"===e?2:"Third"===e?3:"Fourth"===e?4:5,k=e=>1===e||"1"===e?"First":2===e||"2"===e?"Second":3===e||"3"===e?"Third":4===e||"4"===e?"Fourth":"Last",E=(e,t)=>{if(!t)return{};const n=t.split(" ");if(n.length<5)return{};const a={},l=n[4],o=n[3],r=n[2];if("weekly"===e){if(a.selectedWeeks="?"===l?[0,1,2,3,4,5,6]:l.split(",").map((e=>Number(e))),"?"===l)return a.selectedWeeks=[0,1,2,3,4,5,6],a;const e=[];return l.split(",").forEach((t=>{if(Number.isNaN(t)||Number.isNaN(parseFloat(t))){const a="SUN"===(n=t)?.toUpperCase()?0:"MON"===n?.toUpperCase()?1:"TUE"===n?.toUpperCase()?2:"WED"===n?.toUpperCase()?3:"THU"===n?.toUpperCase()?4:"FRI"===n?.toUpperCase()?5:"SAT"===n?.toUpperCase()?6:void 0;a&&e.push(a)}else e.push(Number(t));var n})),a.selectedWeeks=e,a}if("*"===o&&"monthly"===e){if("?"===l&&!isNaN(r)&&!isNaN(parseFloat(r)))return a.monthOption="standard",a.selectedMonthDate=Number(r),a;if(a.monthOption="custom","?"===l)r.includes("L")&&(a.selectedMonthDayOrder="Last"),r.includes("W")?(a.selectedMonthDay="Weekday",a.selectedMonthDayOrder=k(r.slice(0,1))):a.selectedMonthDay="Day";else if(l.includes("L")){const e=y.find((e=>e.value===Number(l.slice(0,1))));a.selectedMonthDay=e?.name}else if(l.includes("#")){a.selectedMonthDayOrder=k(l.charAt(l.length-1));const e=y.find((e=>e.value===Number(l.slice(0,1))));a.selectedMonthDay=e?.name}return a}return a};function g(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===n&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}var f={mainContainer:"DateSelection-module_mainContainer__Jn8mk",endType:"DateSelection-module_endType__g3adX",endContainer:"DateSelection-module_endContainer__vEHSM",startDate:"DateSelection-module_startDate__-Y2W4",endCount:"DateSelection-module_endCount__GG4GH"};function C(t){const n=t?.styles||{},{recurrenceData:l,dispatch:o}=a(i),{selectedEndType:d,startDate:c,endDate:s,endCount:u,disabled:m}=l;return e.createElement("div",{className:f.mainContainer,style:n.dateContainer},e.createElement("div",{className:f.startContainer},e.createElement("label",{style:n.startLabel},"Start"),e.createElement("input",{disabled:m,value:c,onChange:e=>{o({type:r.SetStartDate,payload:e?.target?.value})},className:f.startDate,style:n.startDate,type:"date",id:"start",name:"start"})),e.createElement("div",{className:f.endContainer},e.createElement("label",{style:n.endLabel},"End"),e.createElement("select",{key:"endType",disabled:m,value:d,className:f.endType,style:n.endType,onChange:e=>{o({type:r.SetEndType,payload:e?.target?.value})}},e.createElement("option",{key:"noend",value:"noend"},"no end date"),e.createElement("option",{key:"date",value:"date"},"on this day"),e.createElement("option",{key:"count",value:"count"},"after")),"date"===d?e.createElement("input",{disabled:m,value:s,onChange:e=>{o({type:r.SetEndDate,payload:e?.target?.value})},className:f.endDate,style:n.endDate,type:"date",id:"end",name:"end"}):"count"===d?e.createElement(e.Fragment,null,e.createElement("input",{disabled:m,value:u,onChange:e=>{o({type:r.SetEndCount,payload:e?.target?.value})},className:f.endCount,style:n.endCount,type:"number",min:1}),e.createElement("label",{style:{marginLeft:10}},"occurance")):null))}g("@media only screen and (min-width:641px){.DateSelection-module_mainContainer__Jn8mk{display:flex;flex-direction:row}.DateSelection-module_endType__g3adX{margin-left:20px}}@media only screen and (max-width:641px){.DateSelection-module_endContainer__vEHSM{margin-top:20px}.DateSelection-module_endType__g3adX{margin-left:24px}}.DateSelection-module_mainContainer__Jn8mk{margin-top:20px}.DateSelection-module_startDate__-Y2W4{margin-left:20px;margin-right:20px}.DateSelection-module_endType__g3adX{margin-right:20px}.DateSelection-module_endCount__GG4GH{width:50px}");var v={mainContainer:"Frequency-module_mainContainer__uyQ55",frequencyContainer:"Frequency-module_frequencyContainer__VDM6E",frequencyInput:"Frequency-module_frequencyInput__2mARX",repeatLabel:"Frequency-module_repeatLabel__gfsCa",repeatDropdown:"Frequency-module_repeatDropdown__4WO9R",everyLabel:"Frequency-module_everyLabel__dFHFF",selectedRepeatlLabel:"Frequency-module_selectedRepeatlLabel__jdy-U"};g("@media only screen and (min-width:641px){.Frequency-module_mainContainer__uyQ55{display:flex;flex-direction:row}}@media only screen and (max-width:641px){.Frequency-module_frequencyContainer__VDM6E{margin-top:20px}.Frequency-module_frequencyInput__2mARX{margin-left:6px}}.Frequency-module_repeatLabel__gfsCa{margin-right:20px}.Frequency-module_repeatDropdown__4WO9R{margin-right:40px;width:80px}.Frequency-module_everyLabel__dFHFF{margin-right:20px}.Frequency-module_frequencyInput__2mARX{width:50px}.Frequency-module_selectedRepeatlLabel__jdy-U{margin-left:10px}");const x=["weekly","monthly"];function w(t){const n=t?.styles||{},{recurrenceData:l,dispatch:o}=a(i),{repeat:d,showFrequency:c,frequency:s,disabled:u}=l;return e.createElement("div",{className:v.mainContainer,style:n.frequencyContainer},e.createElement("div",null,e.createElement("label",{className:v.repeatLabel,style:n.repeatLabel},"Repeat"),e.createElement("select",{key:"repeat",style:n.repeatDropdown,disabled:u,value:d,className:v.repeatDropdown,name:"repeat",id:"repeat",onChange:e=>{o({type:r.SetRepeat,payload:e?.target?.value})}},x.map((t=>e.createElement("option",{key:t,value:t},t))))),c&&e.createElement("div",{className:v.frequencyContainer},e.createElement("label",{className:v.everyLabel,style:n.everyLabel},"Every"),e.createElement("input",{style:n.frequencyInput,disabled:u,className:v.frequencyInput,value:s,onChange:e=>{o({type:r.SetFrequency,payload:e?.target?.value})},type:"number",min:1}),e.createElement("label",{className:v.selectedRepeatlLabel,style:n.selectedRepeatlLabel},d?.slice(0,-2),"(s)")))}var M={container:"MonthSelection-module_container__7AbBI",orLabel:"MonthSelection-module_orLabel__jqTMH",mainContainer:"MonthSelection-module_mainContainer__Orlve",standardContainer:"MonthSelection-module_standardContainer__1EEb-",customContainer:"MonthSelection-module_customContainer__4XPHq",dayDropdown:"MonthSelection-module_dayDropdown__bxWL2",orderDropdown:"MonthSelection-module_orderDropdown__H0a7L",monthWeekdayDropdown:"MonthSelection-module_monthWeekdayDropdown__RoW6n",dayLabel:"MonthSelection-module_dayLabel__C04BX",onLabel:"MonthSelection-module_onLabel__TJ8AO"};g("@media only screen and (min-width:641px){.MonthSelection-module_container__7AbBI{display:flex;flex-direction:row}}@media only screen and (max-width:641px){.MonthSelection-module_orLabel__jqTMH{visibility:hidden}}.MonthSelection-module_mainContainer__Orlve{display:flex;flex-direction:row;margin-top:20px}.MonthSelection-module_customContainer__4XPHq,.MonthSelection-module_standardContainer__1EEb-{display:flex;flex-direction:row}.MonthSelection-module_dayDropdown__bxWL2{margin-left:10px;width:50px}.MonthSelection-module_monthWeekdayDropdown__RoW6n,.MonthSelection-module_orderDropdown__H0a7L{margin-left:10px;margin-right:10px;width:100px}.MonthSelection-module_dayLabel__C04BX{margin-left:10px;margin-right:10px}.MonthSelection-module_orLabel__jqTMH{font-size:18px;margin-left:10px;margin-right:10px}.MonthSelection-module_onLabel__TJ8AO{font-size:16px;margin-right:20px;margin-top:3px}");const L=[...Array(32).keys()].filter((e=>0!==e)),W=["First","Second","Third","Fourth","Last"];function F(t){const n=t?.styles||{},{recurrenceData:l,dispatch:o}=a(i),{monthOption:d,selectedMonthDate:c,selectedMonthDayOrder:s,selectedMonthDay:u,disabled:m}=l,p=e=>{o({type:r.SetMonthOption,payload:e?.target?.value})};return e.createElement("div",{className:M.mainContainer,style:n.monthContainer},e.createElement("label",{className:M.onLabel,style:n.onLabel},"On"),e.createElement("div",{className:M.container},e.createElement("div",{className:M.standardContainer},e.createElement("input",{disabled:m,value:"standard",name:"monthOption",checked:"standard"===d,type:"radio",onChange:p}),e.createElement("select",{key:"standardMonthOption",disabled:m||"standard"!==d,value:c,className:M.dayDropdown,style:n.dayDropdown,onChange:e=>{o({type:r.SetMonthDate,payload:e?.target?.value})}},L.map((t=>e.createElement("option",{key:t,value:t},t)))),e.createElement("label",{style:{...n.dayLabel,color:""+("standard"!==d||m?"gray":"")},className:M.dayLabel},"day")),e.createElement("label",{className:M.orLabel,style:n.orLabel},"or"),e.createElement("div",{className:M.customContainer},e.createElement("input",{disabled:m,value:"custom",name:"monthOption",checked:"custom"===d,type:"radio",onChange:p}),e.createElement("select",{key:"orderSelection",disabled:m||"custom"!==d,value:s,className:M.orderDropdown,style:n.orderDropdown,onChange:e=>{o({type:r.SetMonthDayOrder,payload:e?.target?.value})}},W.map((t=>{const n=!["First","Last"].includes(t)&&"Weekday"===u;return e.createElement("option",{key:t,disabled:n,value:t},t)}))),e.createElement("select",{key:"weekdaySelection",disabled:m||"custom"!==d,value:u,className:M.monthWeekdayDropdown,style:n.monthWeekdayDropdown,onChange:e=>{o({type:r.SetMonthDay,payload:e?.target?.value})}},(()=>{let e=[...y];return e=e.concat([{name:"Day",value:"Day"},{name:"Weekday",value:"Weekday"}]),e})().map((t=>{const n="Weekday"===t.name&&!["First","Last"].includes(s);return e.createElement("option",{key:t.name,disabled:n,value:t.name},t.name)}))))))}const N=e=>{const t=new Date(e),n=y.find((e=>e.value===t?.getDay()))?.name;return n},q=e=>{const t=new Date(e);return p[t.getMonth()]},T=e=>{const t=new Date(e).getDate();return t>9?t:`0${t}`};function O(t){const n=t?.styles||{},{recurrenceData:o,dispatch:r}=a(i),{startDate:d,repeat:c,selectedWeeks:s,frequency:u,monthOption:m,selectedMonthDate:p,selectedMonthDayOrder:_,selectedMonthDay:h}=o,D=l((()=>{if(!d)return"";const e=new Date(d),t=N(d),n=q(d);return`starting ${t}, ${T(d)} ${n} ${e.getFullYear()}`}),[d]),S=l((()=>{let e=s;if(d){const t=new Date(d);e=s.filter((e=>e>=t.getDay())).concat(s.filter((e=>e<t.getDay())))}const t=[];if(e.forEach((e=>{const n=y.find((t=>t.value===e));n.name&&t.push(n.name)})),t.length>1){const e=t.pop(),n=t.pop();t.push(`${n} and ${e}`)}return t.join(", ")}),[d,s]);if("weekly"===c&&s?.length>0)return e.createElement("div",{style:{marginTop:20,...n.recurrenceText}},"Occurs",e.createElement("span",{style:{fontWeight:"bold",marginLeft:5,marginRight:5}},"every ",u>1?"weeks on":""," ",S()),D());if("monthly"===c){const t="standard"===m?`day ${p}`:`the ${_?.toLowerCase()} ${h}`;return e.createElement("div",{style:{marginTop:20,...n.recurrenceText}},"Occurs",e.createElement("span",{style:{fontWeight:"bold",marginLeft:5,marginRight:5}},t," of every ",u>1?"months":"month"),D())}return e.createElement(e.Fragment,null)}var B={container:"WeekSelection-module_container__88GLb",weekCheckBoxContainer:"WeekSelection-module_weekCheckBoxContainer__-iuB5",weekdayBtnContainer:"WeekSelection-module_weekdayBtnContainer__7G5w2",weekdayBtn:"WeekSelection-module_weekdayBtn__irczp",selectedWeekdayBtn:"WeekSelection-module_selectedWeekdayBtn__DjAad",weekdayFullTextLabel:"WeekSelection-module_weekdayFullTextLabel__foOGD"};function R(t){const n=t?.styles||{},{recurrenceData:l,dispatch:o}=a(i),{selectedWeeks:d,disabled:c}=l,s=e=>{const t=d.includes(e)?d.filter((t=>t!==e)).sort():d.concat([e]).sort();o({type:r.SetSelectedWeeks,payload:t})},u=e=>{let t=e?.target?.value;t&&(t=Number(t),s(t))};return e.createElement("div",{style:n.weekContainer},e.createElement("div",{className:B.container},y.map(((t,a)=>e.createElement("div",{key:a,className:B.weekdayBtnContainer,style:n.weekdayBtnContainer},e.createElement("button",{type:"button",disabled:c,value:t.value,className:d.includes(t.value)?B.selectedWeekdayBtn:B.weekdayBtn,style:d.includes(t.value)?n.selectedWeekdayBtn:n.weekdayBtn,onClick:e=>s(t.value)},t.name.slice(0,3)))))),e.createElement("div",{className:B.weekCheckBoxContainer},y.map((t=>e.createElement("label",{key:t.name},e.createElement("input",{disabled:c,checked:d.includes(t.value),type:"checkbox",onChange:u,value:t.value}),e.createElement("span",{className:B.weekdayFullTextLabel,style:d.includes(t.value)?n.selectedWeekdayFullTextLabel:n.weekdayFullTextLabel},t.name))))))}function $(t){const{recurrenceData:n,dispatch:l}=a(i),{repeat:d,selectedWeeks:c,cronExpression:s,monthOption:u,selectedMonthDate:m,selectedMonthDay:y,selectedMonthDayOrder:p,frequency:k,startDate:g,endDate:f,endCount:v,selectedEndType:x}=n;return o((()=>{let e={...t};if(t.value&&(e={...e,...t.value}),e.cronExpression&&""!==e.cronExpression){const t=E(e.repeat,e.cronExpression);e.cronExpression&&e.cronExpression,t&&(e={...e,...t})}l({type:r.SetInitialProps,payload:e})}),[t]),o((()=>{let e="";if("weekly"===d)e=_(c);else if("monthly"===d)if("custom"===u){const t=b(p);"Day"===y?e="Last"===p?"0 0 L * ?":h(t):"Weekday"===y?"First"===p?e="0 0 1W * ?":"Last"===p&&(e="0 0 LW * ?"):e="Last"===p?D(y):S(t,y)}else e=h(m);l({type:r.SetCronExp,payload:e})}),[d,c,u,m,y,p]),o((()=>{const e={repeat:d,cronExpression:s,frequency:k,startDate:g};"date"===x?e.endDate=f:"count"===x&&(e.endCount=v),t.onChange&&t.onChange(e)}),[d,s,k,g,f,v,x]),e.createElement("div",{style:t?.styles?.root},e.createElement(w,t),"weekly"===d?e.createElement(R,t):"monthly"===d?e.createElement(F,t):null,e.createElement(C,t),e.createElement(O,t),t.showCronExpression&&e.createElement("div",{style:{marginTop:20}},s))}g('@media only screen and (min-width:641px){.WeekSelection-module_container__88GLb{display:flex;flex-direction:row}.WeekSelection-module_weekCheckBoxContainer__-iuB5{display:none}}@media only screen and (max-width:641px){.WeekSelection-module_container__88GLb{display:none}.WeekSelection-module_weekCheckBoxContainer__-iuB5{display:flex;flex-direction:column;margin-top:20px}}.WeekSelection-module_weekdayBtnContainer__7G5w2{margin:10px}.WeekSelection-module_weekdayBtn__irczp{background-color:#aaa}.WeekSelection-module_selectedWeekdayBtn__DjAad,.WeekSelection-module_weekdayBtn__irczp{border:1px;border-color:"#6b6b6b";border-radius:50%;color:#e2e2e2;height:40px;width:40px}.WeekSelection-module_selectedWeekdayBtn__DjAad{background-color:#4eaeec}.WeekSelection-module_weekdayFullTextLabel__foOGD{margin-left:5px}');const A=t=>e.createElement(m,null,e.createElement($,t));export{A as Recurrence};
